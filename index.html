<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>3D Tank Battle</title>
<style>body { margin: 0; overflow: hidden; }</style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.153.0/examples/js/controls/OrbitControls.js"></script>
<script>
let scene = new THREE.Scene();
scene.background = new THREE.Color(0x555555);

let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0, 50, 50);
camera.lookAt(0,0,0);

let renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Controls
let controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enablePan = false;
controls.maxPolarAngle = Math.PI/2;

// Lighting
let light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(50,50,50);
scene.add(light);
scene.add(new THREE.AmbientLight(0x404040));

// Ground
let groundGeo = new THREE.PlaneGeometry(100, 100);
let groundMat = new THREE.MeshStandardMaterial({color: 0x228B22});
let ground = new THREE.Mesh(groundGeo, groundMat);
ground.rotation.x = -Math.PI/2;
scene.add(ground);

// Obstacles
let obstacles = [];
for(let i=0;i<10;i++){
    let boxGeo = new THREE.BoxGeometry(5,5,5);
    let boxMat = new THREE.MeshStandardMaterial({color:0x8B4513});
    let box = new THREE.Mesh(boxGeo, boxMat);
    box.position.set(Math.random()*80-40,2.5,Math.random()*80-40);
    scene.add(box);
    obstacles.push(box);
}

// Player tank
let playerGeo = new THREE.BoxGeometry(3,2,4);
let playerMat = new THREE.MeshStandardMaterial({color:0x00ff00});
let playerTank = new THREE.Mesh(playerGeo, playerMat);
playerTank.position.y = 1;
scene.add(playerTank);

// Enemy tanks
let enemies = [];
for(let i=0;i<5;i++){
    let enemyGeo = new THREE.BoxGeometry(3,2,4);
    let enemyMat = new THREE.MeshStandardMaterial({color:0xff0000});
    let enemy = new THREE.Mesh(enemyGeo, enemyMat);
    enemy.position.set(Math.random()*80-40,1,Math.random()*80-40);
    enemy.health = 50; // weaker than player
    scene.add(enemy);
    enemies.push(enemy);
}

// Basic movement
let keys = {};
document.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

function movePlayer(){
    let speed = 0.5;
    if(keys['w']) playerTank.position.z -= speed;
    if(keys['s']) playerTank.position.z += speed;
    if(keys['a']) playerTank.position.x -= speed;
    if(keys['d']) playerTank.position.x += speed;

    // simple obstacle collision
    obstacles.forEach(obs=>{
        if(playerTank.position.distanceTo(obs.position)<4){
            // simple pushback
            if(keys['w']) playerTank.position.z += speed;
            if(keys['s']) playerTank.position.z -= speed;
            if(keys['a']) playerTank.position.x += speed;
            if(keys['d']) playerTank.position.x -= speed;
        }
    });
}

// Enemy AI
function enemyAI(){
    enemies.forEach(enemy=>{
        if(enemy.health<=0) return; // dead, keep on map but visually down
        let dir = new THREE.Vector3();
        dir.subVectors(playerTank.position, enemy.position).normalize();
        enemy.position.addScaledVector(dir, 0.2); // move slowly
        // collision with obstacles
        obstacles.forEach(obs=>{
            if(enemy.position.distanceTo(obs.position)<4){
                enemy.position.addScaledVector(dir,-0.2);
            }
        });
        // collision with player
        if(enemy.position.distanceTo(playerTank.position)<5){
            playerTank.health = (playerTank.health||100)-0.2; // slowly drain health
        }
    });
}

// Health bar
let healthBar = document.createElement('div');
healthBar.style.position='absolute';
healthBar.style.top='10px';
healthBar.style.left='10px';
healthBar.style.width='200px';
healthBar.style.height='20px';
healthBar.style.background='red';
document.body.appendChild(healthBar);
let healthFill = document.createElement('div');
healthFill.style.width='100%';
healthFill.style.height='100%';
healthFill.style.background='lime';
healthBar.appendChild(healthFill);

// Animate
function animate(){
    requestAnimationFrame(animate);
    movePlayer();
    enemyAI();
    // update health bar
    healthFill.style.width = ((playerTank.health||100)/100*100)+'%';
    // make health go negative visually if dead
    if((playerTank.health||0)<0) healthFill.style.width = (playerTank.health||0)+'%';

    renderer.render(scene, camera);
}
animate();
</script>
</body>
</html>
