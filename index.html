<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>3D Tank Battle</title>
<style>
  body { margin:0; overflow:hidden; background:#222; }
  #healthBar { position:absolute; top:10px; left:10px; width:200px; height:20px; background:red; }
  #healthFill { width:100%; height:100%; background:lime; }
</style>
</head>
<body>
<div id="healthBar"><div id="healthFill"></div></div>
<script src="https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.min.js"></script>
<script>
// --- Scene ---
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87CEEB);

// --- Camera ---
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 500);
camera.position.set(0, 60, 60);
camera.lookAt(0, 0, 0);

// --- Renderer ---
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

// --- Lights ---
const light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(50, 100, 50);
light.castShadow = true;
scene.add(light);
scene.add(new THREE.AmbientLight(0x404040));

// --- Ground ---
const groundMat = new THREE.MeshStandardMaterial({color:0x228B22});
const groundGeo = new THREE.PlaneGeometry(100,100);
const ground = new THREE.Mesh(groundGeo, groundMat);
ground.rotation.x = -Math.PI/2;
ground.receiveShadow = true;
scene.add(ground);

// --- Obstacles ---
const obstacles = [];
for(let i=0;i<10;i++){
  const boxGeo = new THREE.BoxGeometry(5,5,5);
  const boxMat = new THREE.MeshStandardMaterial({color:0x8B4513});
  const box = new THREE.Mesh(boxGeo, boxMat);
  box.position.set(Math.random()*80-40,2.5,Math.random()*80-40);
  box.castShadow = true;
  scene.add(box);
  obstacles.push(box);
}

// --- Player Tank ---
const playerGeo = new THREE.BoxGeometry(3,2,4);
const playerMat = new THREE.MeshStandardMaterial({color:0x00ff00});
const playerTank = new THREE.Mesh(playerGeo, playerMat);
playerTank.position.set(0,1,0);
playerTank.castShadow = true;
playerTank.health = 100;
scene.add(playerTank);

// --- Enemy Tanks ---
const enemies = [];
for(let i=0;i<5;i++){
  const enemyGeo = new THREE.BoxGeometry(3,2,4);
  const enemyMat = new THREE.MeshStandardMaterial({color:0xff0000});
  const enemy = new THREE.Mesh(enemyGeo, enemyMat);
  enemy.position.set(Math.random()*80-40,1,Math.random()*80-40);
  enemy.castShadow = true;
  enemy.health = 50;
  scene.add(enemy);
  enemies.push(enemy);
}

// --- Movement ---
const keys = {};
document.addEventListener('keydown', e=>keys[e.key.toLowerCase()]=true);
document.addEventListener('keyup', e=>keys[e.key.toLowerCase()]=false);

function movePlayer(){
  const speed = 0.5;
  if(keys['w']) playerTank.position.z -= speed;
  if(keys['s']) playerTank.position.z += speed;
  if(keys['a']) playerTank.position.x -= speed;
  if(keys['d']) playerTank.position.x += speed;

  // Collision with obstacles
  obstacles.forEach(obs=>{
    if(playerTank.position.distanceTo(obs.position)<4){
      if(keys['w']) playerTank.position.z += speed;
      if(keys['s']) playerTank.position.z -= speed;
      if(keys['a']) playerTank.position.x += speed;
      if(keys['d']) playerTank.position.x -= speed;
    }
  });
}

// --- Enemy AI ---
function enemyAI(){
  enemies.forEach(enemy=>{
    if(enemy.health<=0) return;
    const dir = new THREE.Vector3();
    dir.subVectors(playerTank.position, enemy.position).normalize();
    enemy.position.addScaledVector(dir,0.2);
    obstacles.forEach(obs=>{
      if(enemy.position.distanceTo(obs.position)<4){
        enemy.position.addScaledVector(dir,-0.2);
      }
    });
    if(enemy.position.distanceTo(playerTank.position)<5){
      playerTank.health -= 0.1; // weaker attacks
    }
  });
}

// --- Health Bar ---
const healthFill = document.getElementById('healthFill');

// --- Animation Loop ---
function animate(){
  requestAnimationFrame(animate);
  movePlayer();
  enemyAI();
  healthFill.style.width = ((playerTank.health||0)/100*100)+'%';
  if(playerTank.health<0) healthFill.style.width = playerTank.health+'%';
  renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
